{% extends 'base.html' %}

{% block title %}Map{% endblock %}

{% block style %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>
{% endblock %}

{% block head_script %}
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  crossorigin=""></script>
{% endblock %}

{% block content %}
<div id="map" style="width:100%; height:700px;"></div>
        <script type="text/javascript">
            var osmLayer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Data, imagery and map information provided by <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors.'
            });
            var test = L.layerGroup();
            var map = L.map('map',{
              center: [0,0],
              zoom: 3,
              layers:[osmLayer,test]
            });
            // map.addLayer(osmLayer);
            var test_points =  {
              "type": "FeatureCollection",
              "features": [
                {% for obj in test_data %}
                {
                  "type": "Feature",
                  "properties": {
                    "tweet": "{{obj['tweet_text']}}"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [{{ obj['longitude'] }}, {{obj['latitude']}}]
                  }
                }{% if not loop.last %},{% endif %}
                {% endfor %}
              ]
            };

            L.geoJson(test_points,{
              onEachFeature: function(feature, layer) {
                    layer.bindPopup(feature.properties.tweet);
                }
            }).addTo(test);

            var overlays = {
              "Test Data": test
            };
            var baseLayers = {
              "OpenStreetMap": osmLayer
            };

            L.control.layers(baseLayers,overlays).addTo(map);

        </script>
<p>  {"type": "FeatureCollection",
  "features": [
    {% for tweet in eq_data %}
    {{tweet['location']}}
    {% if not loop.last %},{% endif %}
    {% endfor %}
  ]
}</p>
{% endblock %}
