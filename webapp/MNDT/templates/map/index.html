{% extends 'base.html' %}

{% block title %}Map{% endblock %}

{% block style %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
  crossorigin=""/>
{% endblock %}

{% block head_script %}
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
  integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
  crossorigin=""></script>
{% endblock %}

{% block content %}
<div id="map" style="width:100%; height:700px;"></div>
        <script type="text/javascript">
            var map = L.map('map').setView([0, -0], 3);
            var osmLayer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: 'Data, imagery and map information provided by <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors.'
            });
            map.addLayer(osmLayer);
            var points =  {
              "type": "FeatureCollection",
              "features": [
                {% for obj in data %}{% if obj.predicted_relevant != 0%}
                {
                  "type": "Feature",
                  "properties": {
                    "tweet": "{{ obj.tweet_text}}"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [{{ obj.longitude }}, {{ obj.latitude}}]
                  }
                }{% endif %}{% if not loop.last %},{% endif %}
                {% endfor %}
              ]
            };
            var dataLayer = L.geoJson(points,{
              onEachFeature: function(feature, layer) {
                    layer.bindPopup(feature.properties.tweet);
                }
            });
            map.addLayer(dataLayer);
        </script>
{% endblock %}
